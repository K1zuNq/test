<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>学力テスト</title>

<style>
body{
    font-family:sans-serif;
    margin:20px;
    line-height:1.6;
    user-select:none;
}
h1{text-align:center;}
.section{margin-top:30px;}
textarea{width:100%;height:70px;}
input[type="text"]{width:100%;}
.warning{color:red;font-weight:bold;}
input,textarea{user-select:text;}
button{
    padding:12px 24px;
    font-size:18px;
    background:#4CAF50;
    color:white;
    border:none;
    border-radius:6px;
}
#timer{
    font-size:22px;
    font-weight:bold;
    color:red;
    text-align:center;
    margin-bottom:10px;
}
</style>

<script>
// ===== コピペ対策 =====
document.addEventListener("copy", e => e.preventDefault());
document.addEventListener("paste", e => e.preventDefault());
document.addEventListener("cut", e => e.preventDefault());
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("selectstart", e => e.preventDefault());
document.addEventListener("keydown", function(e){
    if(e.ctrlKey || e.metaKey){
        if(["c","v","x","u","s","a","p"].includes(e.key.toLowerCase())){
            e.preventDefault();
        }
    }
    if(e.key==="F12"){ e.preventDefault(); }
});

// ===== 画面離脱警告 =====
document.addEventListener("visibilitychange", function(){
    if(document.hidden){
        alert("画面を離れました。不正の可能性があります。");
    }
});

// ===== タイマー（30分）=====
let totalTime = 1800;
let startTime;

function countdown(){
    let min = Math.floor(totalTime/60);
    let sec = totalTime%60;
    document.getElementById("timer").textContent =
        "残り時間: " + min + "分 " + sec + "秒";
    totalTime--;
    if(totalTime >= 0){
        setTimeout(countdown,1000);
    } else {
        alert("時間終了");
        document.body.innerHTML="<h1>試験終了</h1>";
    }
}

window.onload = function(){
    startTime = new Date().getTime();
    countdown();
};

// ===== 提出処理（修正版）=====
async function submitTest(){
    const endTime = new Date().getTime();
    const elapsed = Math.floor((endTime - startTime)/1000);

    // 50問分の値を取得
    const answers = [];
    for(let i=1;i<=50;i++){
        const el = document.getElementById("q"+i);
        answers.push(el ? el.value : "");
    }

    const payload = {
        name: document.getElementById("name").value,
        answers: answers.join(" / "),
        time: elapsed + "秒"
    };

    try{
        const response = await fetch("https://script.google.com/macros/s/AKfycbwYTbUpEaeumAVskA-cQ4z6CuDQDrzciL0WjwJoDXRiSqJgHW347GBo_75GLt4GRDtjvQ/exec",{
            method:"POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        const text = await response.text();
        alert("提出完了：" + text);

    }catch(error){
        alert("送信エラー：" + error);
        console.error(error);
    }
}
</script>

</head>
<body>

<h1>学力テスト</h1>
<p id="timer"></p>
<p class="warning">制限時間30分 / コピペ禁止 / 不正検知あり</p>

<p>名前（必須）</p>
<input type="text" id="name">

<!-- 国語 -->
<div class="section">
<h2>【国語】20点</h2>
<p>① 「相対」の意味を説明せよ。</p><textarea id="q1"></textarea>
<p>② 「彼は静かに本を読んでいた。」の主語を書け。</p><input id="q2" type="text">
<p>③ 「具体」の対義語を書け。</p><input id="q3" type="text">
<p>④ 「努力を惜しまない」の意味を説明せよ。</p><textarea id="q4"></textarea>
<p>⑤ 「静かだ」の品詞を答えよ。</p><input id="q5" type="text">
<p>⑥ 「彼の声は雷のようだった。」の比喩の種類を答えよ。</p><input id="q6" type="text">
<p>⑦ 「臨機応変」の意味を書け。</p><textarea id="q7"></textarea>
<p>⑧ 「先生が言いました」を尊敬語に直せ。</p><textarea id="q8"></textarea>
<p>⑨ 適切な接続詞を入れよ：「雨が降っている。＿＿＿、試合は続行された。」</p><input id="q9" type="text">
<p>⑩ 「石の上にも三年」を使って例文を書け。</p><textarea id="q10"></textarea>
</div>

<!-- 数学 -->
<div class="section">
<h2>【数学】20点</h2>
<p>① 5×12</p><input id="q11" type="text">
<p>② 15−9</p><input id="q12" type="text">
<p>③ 4x+7=23 を解け。</p><input id="q13" type="text">
<p>④ (x+4)(x-2) を展開せよ。</p><input id="q14" type="text">
<p>⑤ √72 を簡単にせよ。</p><input id="q15" type="text">
<p>⑥ y=x²-4 の頂点を答えよ。</p><input id="q16" type="text">
<p>⑦ サイコロで3の倍数が出る確率。</p><input id="q17" type="text">
<p>⑧ x+y=7, x-y=1 を解け。</p><input id="q18" type="text">
<p>⑨ 半径4cmの円の面積（π=3.14）</p><input id="q19" type="text">
<p>⑩ 質量5kg、力20Nの加速度。</p><input id="q20" type="text">
</div>

<!-- 英語 -->
<div class="section">
<h2>【英語】20点</h2>
<p>① difficult の意味。</p><input id="q21" type="text">
<p>② (a)quick (b)slow (c)happy 反対語を選べ（quickの反対）</p><input id="q22" type="text">
<p>③ He play soccer. を正しく直せ。</p><input id="q23" type="text">
<p>④ I have lived here (since / for) five years。</p><input id="q24" type="text">
<p>⑤ 並び替え： ( to / I / want / doctor / be / a )</p><input id="q25" type="text">
<p>⑥ 和訳：This book is interesting.</p><textarea id="q26"></textarea>
<p>⑦ 「私は明日東京へ行く。」を英訳せよ。</p><input id="q27" type="text">
<p>⑧ They built this bridge. を受動態にせよ。</p><input id="q28" type="text">
<p>⑨ 「彼は私より背が高い。」を英訳せよ。</p><input id="q29" type="text">
<p>⑩ 和訳：She has just finished her homework.</p><textarea id="q30"></textarea>
</div>

<!-- 理科 -->
<div class="section">
<h2>【理科】20点</h2>
<p>① 光合成に必要な気体。</p><input id="q31" type="text">
<p>② 血液中で酸素を運ぶ成分。</p><input id="q32" type="text">
<p>③ 二酸化炭素の化学式。</p><input id="q33" type="text">
<p>④ 酸性水溶液の性質を1つ。</p><input id="q34" type="text">
<p>⑤ 力の単位。</p><input id="q35" type="text">
<p>⑥ 速さの公式。</p><input id="q36" type="text">
<p>⑦ 最初に到達する地震波。</p><input id="q37" type="text">
<p>⑧ 月が満ち欠けする理由。</p><textarea id="q38"></textarea>
<p>⑨ 加速度の求め方。</p><input id="q39" type="text">
<p>⑩ 金属が電気を通す理由。</p><textarea id="q40"></textarea>
</div>

<!-- 社会 -->
<div class="section">
<h2>【社会】20点</h2>
<p>① 太平洋ベルトが発達した理由。</p><textarea id="q41"></textarea>
<p>② 日本の気候に地域差が生じる理由。</p><textarea id="q42"></textarea>
<p>③ EEZとは何か。</p><input id="q43" type="text">
<p>④ 鎌倉幕府が成立した年。</p><input id="q44" type="text">
<p>⑤ 明治維新で起きた政治の変化。</p><textarea id="q45"></textarea>
<p>⑥ 鎖国の目的。</p><textarea id="q46"></textarea>
<p>⑦ 日本国憲法第9条の内容。</p><textarea id="q47"></textarea>
<p>⑧ 衆議院の優越が認められる理由。</p><textarea id="q48"></textarea>
<p>⑨ 三権分立の3つ。</p><input id="q49" type="text">
<p>⑩ 少子高齢化が社会に与える影響。</p><textarea id="q50"></textarea>
</div>

<br><br>
<button onclick="submitTest()">提出</button>

</body>
</html>

